import TelegramBot from "node-telegram-bot-api"
import { AppDataSource } from "../data-source";
import { User } from "../entity/User";
import { MessageFormatter } from "../utils/MessageFormatter";

const bot = new TelegramBot(process.env.SPAMBOT_TOKEN ?? "",  {
    polling: true
});

bot.setMyCommands([
    {
        command: "about",
        description: "ü§ñ–û –±–æ—Ç–µ"
    },
    {
        command: "company",
        description: "ü§ù–û –Ω–∞—Å (SmartComrade)"
    },
    {
        command: "links",
        description: "üå±–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏"
    },
    {
        command: "materials",
        description: "üöÄ–ü–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã"
    },
    {
        command: "support",
        description: "üí°–ü–æ–¥–¥–µ—Ä–∂–∫–∞"
    }
]);

AppDataSource.initialize();

bot.onText(/\/about/, async (msg) => {
    await bot.sendMessage(msg.from!.id, "–î–∞–≤–∞–π —è —Ç–µ–±–µ —Ä–∞—Å—Å–∫–∞–∂—É –Ω–µ–º–Ω–æ–≥–æ –æ —Å–µ–±–µ! –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤—Å–µ –≤—Å—Ç–∞–ª–æ –Ω–∞ —Å–≤–æ–∏ –º–µ—Å—Ç–∞. –Ø –º–æ–≥—É –±—ã—Ç—å —Ç–≤–æ–∏–º –Ω–µ–∑–∞–º–µ–Ω–∏–º—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–æ—Ä–æ–º)\n\n–î–ª—è —á–µ–≥–æ —è —Ç—É—Ç?\nüî∏–ë—É–¥—É —Å–æ–æ–±—â–∞—Ç—å —Ç–µ–±–µ –ø—Ä–æ –≤—Å–µ –≤–∞–∂–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ\nüî∏–ë—É–¥—É —Å–ø–æ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–±—è –æ–±–∞–ª–¥–µ–Ω–Ω–æ–π –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏–∑ –º–∏—Ä–∞ –Ω–µ–π—Ä–æ-—Å–µ—Ç–µ–π\nüî∏–î–∞–º —Ç–µ–±–µ –¥–æ—Å—Ç—É–ø –∫ –æ–±–µ—â–∞–Ω–Ω—ã–º –ø–æ–¥–∞—Ä–æ—á–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º\nüî∏–ó–¥–µ—Å—å —Ç—ã —Å–º–æ–∂–µ—à—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –ø–æ–¥—Ö–æ–¥–∏—Ç—å –∏—Ç–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π\n\n–°–æ –≤—Å–µ–π –ª—é–±–æ–≤—å—é, –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫ SmartComradeü´∂");
});

bot.onText(/\/company/, async (msg) => {
    await bot.sendMessage(msg.from!.id, "–ü—Ä–∏–≤–µ—Ç! üëã –ù–∞ —Å–≤—è–∑–∏ SmartComrade)\n–ú—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã—Ö –Ω–µ–π—Ä–æ-—Å–æ—Ç—Ä—É–¥–Ω–∫–∏–æ–≤ –ø–æ–¥ —Ä–µ—à–µ–Ω–∏–µ –ª—é–±—ã—Ö –∑–∞–¥–∞—á.\n\nüí°–¢–æ–ª—å–∫–æ –ø—Ä–µ–¥—Å—Ç–∞–≤—å: \n–û–±—É—á–µ–Ω–Ω—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã —Ä–∞–∑–Ω—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π (–û—Ç –±–∏–∑–Ω–µ—Å-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ - –¥–æ AI —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤ –∏ –∫–∏–Ω–æ-—ç–∫—Å–ø–µ—Ä—Ç–æ–≤), –∫–æ—Ç–æ—Ä—ã–µ –≥–æ—Ç–æ–≤—ã –ø–∞—Ö–∞—Ç—å –Ω–∞ —Ç–µ–±—è 24/7.\n\nüöÄ –≠—Ç–æ –æ—Ç–ª–∏—á–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ\n–ù–µ–π—Ä–æ-—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ—Ç SmartComrade:\n\nüß¨ –í–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–º–æ—â–Ω–∏–∫–∏ –ø—Ä—è–º–æ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º\nüß¨ AI —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–º –Ω–µ –Ω—É–∂–µ–Ω VPN.\nüß¨ –í—Å–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–æ–¥–µ–ª–∏ AI –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ\nüß¨ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å —Ñ–æ—Ç–æ, –∞—É–¥–∏–æ —Å–æ–æ–±—â–µ–Ω–∏—è, —Ñ–∞–π–ª—ã\nüß¨ –ë–æ–ª–µ–µ 15 –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º, –≤ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —Ä–∞–∑–Ω—ã—Ö —Å—Ñ–µ—Ä–∞—Ö\nüß¨ 24/7 –ø–æ–¥ —Ä—É–∫–æ–π\n\n–ê –≤–æ—Ç –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:\n@NComrades_bot\nüéÅ –ö—Å—Ç–∞—Ç–∏, –Ω–µ –∑–∞–±—É–¥—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –∏ –ø–æ–ª—É—á–∏ –¥–æ—Å—Ç—É–ø –∫ –ø–µ—Ä–µ–¥–æ–≤—ã–º –º–æ–¥–µ–ª—è–º –ò–ò –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å");
})

bot.onText(/\/links/, async (msg) => {
    await bot.sendMessage(msg.from!.id, "‚úÖ–í—Å–µ —á–µ—Å—Ç–Ω–æ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ\n–í–æ—Ç –∏ —Å—Å—ã–ª–æ—á–∫–∏:\nüî∏–ù–∞—à –∫–∞–Ω–∞–ª: https://t.me/SmartComrade1\n\nüî∏–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å –Ω–µ–π—Ä–æ-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏: @NComrades_bot\n\nüî∏–û –∫–æ–º–ø–∞–Ω–∏–∏: SmartComrade.pdf\n\nüî∏–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏: –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏\n\nüî∏–£—Å–ª–æ–≤–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è: –£—Å–ª–æ–≤–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è\n\nüî∏–£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã: –†–µ–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏\n\nüî∏–°–ø—Ä–∞–≤–∫–∞ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º: –°–ø—Ä–∞–≤–∫–∞ –æ —Ç–∞—Ä–∏—Ñ–∞—Ö");
})

bot.onText(/\/support/, async (msg) => {
    await bot.sendMessage(msg.from!.id, "–í–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –ø–∏—à–∏—Ç–µ –Ω–∞–º:\n–û—Ç–≤–µ—Ç–∏–º –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è))\nEmail:\nsmartcomradeai@gmail.com\nTg:\n@SmartComrade_Support");
})

bot.onText(/\/start/, async (msg) => {
    // let user = await AppDataSource.manager.findOneBy(User, {
    //     chatId: String(msg.from!.id)
    // });

    // if (!user) {
    //     user = new User();
    //     user.chatId = String(msg.from!.id);
    //     await AppDataSource.manager.save(user);
    // }

    await MessageFormatter.sendTextFromFileBot(bot, "startleadmagnit.txt", msg.from!.id);
})

bot.onText(/\/materials/, async (msg) => {
    await bot.sendMessage(msg.from!.id, "–ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –¥–ª—è –≤–∞—Å –æ–±–∞–ª–¥–µ–Ω–Ω—ã–µ –ø–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–ø—Ä–æ—Å—Ç—è—Ç –∂–∏–∑–Ω—å –∏ —Å–ø–∞—Å—É—Ç –æ—Ç –≥–æ–ª–æ–≤–Ω–æ–π –±–æ–ª–∏ üéÅ\n–í–æ—Ç, —á—Ç–æ —É –Ω–∞—Å –¥–ª—è –≤–∞—Å –µ—Å—Ç—å:\n–ü–æ–¥–±–æ—Ä–∫–∞ 500 –Ω–µ–π—Ä–æ-—Å–µ—Ç–µ–π –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏ \n–ü–æ–¥–±–æ—Ä–∫–∞ –Ω–µ–π—Ä–æ-—Å–µ—Ç–µ–π –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–Ω–∏—à–∞—Ö\n–ü–æ–¥–±–æ—Ä–∫–∞ –ø—Ä–æ–º—Ç–æ–≤ –æ—Ç —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ SmartComrade\n–ù–µ–π—Ä–æ-—Å–≤—è–∑–∫–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ü–µ–ª—ã—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ \n\n–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å –∏—Ö, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å–ª–æ–≤–∏–π: \n–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª: https://t.me/SmartComrade1\n–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –Ω–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ: @NComrades_bot\n(–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–∞—Ç—å ¬´START¬ª)", {
        reply_markup: {
            inline_keyboard: [
                [
                    {
                        text: "–Ø –≤—Å–µ –≤—ã–ø–æ–ª–Ω–∏–ª",
                        callback_data: "complete"
                    }
                ]
            ]
        }
    })
});

bot.on("callback_query", async (q) => {
    const u = await AppDataSource.manager.findOneBy(User, {
        chatId: String(q.from.id)
    });

    const member = await bot.getChatMember(-1002458365675, q.from.id);

    if (!member || !u) return await bot.sendMessage(q.from.id, "–ö–∞–∂–µ—Ç—Å—è, –≤—ã –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –≤—Å–µ —É—Å–ª–æ–≤–∏—è");

    await bot.sendMessage(q.from.id, "–û—Ç–ª–∏—á–Ω–æ! –ê –≤–æ—Ç –∏ –æ–±–µ—â–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:\n https://teletype.in/@smartcomrade/PI7rcWYq-wV");
    await MessageFormatter.sendDocumentBot("prompts.pdf", bot, q.from.id);
    await MessageFormatter.sendDocumentBot("other.pdf", bot, q.from.id);
})

