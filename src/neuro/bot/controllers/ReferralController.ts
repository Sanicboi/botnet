import { User } from "../../../entity/User";
import { wait } from "../../../utils/wait";
import { Bot } from "../../Bot";
import { IController } from "../Controller";

export class ReferralController implements IController {
  constructor(private bot: Bot) {}

  public bind() {
    this.bot.bot.onText(/\/ref/, async (msg) => {
      const user = await this.bot.getUser(msg);
      await this.onRef(user);
    });
  }

  private async onRef(user: User) {
    if (user.inviteCount >= 30)
      return await this.bot.bot.sendMessage(
        +user.chatId,
        "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π –±–æ–ª—å—à–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –í—ã —É–∂–µ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ 30 –¥—Ä—É–∑–µ–π",
      );

    await this.bot.bot.sendMessage(
      +user.chatId,
      `üíå –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ–ª—É—á–∏—Ç—å 1000 —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–≤–æ–π –±–∞–ª–∞–Ω—Å!\n\n- –ö–æ–≥–¥–∞ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å—Ç–∏—Ç –±–æ—Ç–∞, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –Ω–∞ —Å–≤–æ–π –±–∞–ª–∞–Ω—Å;\n- –í—Å–µ–≥–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å 30-x –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ ${user.inviteCount}/30 –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π);\n- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–ø–µ—Ä–≤—ã–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º –ø–æ –≤–∞—à–µ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ.\n\n–î–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:`,
    );
    await wait(3);
    await this.bot.bot.sendMessage(
      +user.chatId,
      `–ü—Ä–∏–≤–µ—Ç!üëã\n –Ø –Ω–∞—à–µ–ª –∫—Ä—É—Ç–æ–π —Å–µ—Ä–≤–∏—Å ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å –Ω–µ–π—Ä–æ-—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á.. üéØ –£–∂–µ –ø–æ–ª—å–∑—É—é—Å—å, –∏ —Ä–µ–∞–ª—å–Ω–æ —É–¥–æ–±–Ω–æ!üòç\n–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å, –ø–µ—Ä–µ—Ö–æ–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ –∏ –∑–∞–ø—É—Å–∫–∞–π –±–æ—Ç–∞ ‚Äî —Ç–µ–±–µ –ø–æ–Ω—Ä–∞–≤–∏—Ç—Å—è! üòâ\nhttps://t.me/NComrades_bot?start=${user.chatId}`,
    );
  }
}
